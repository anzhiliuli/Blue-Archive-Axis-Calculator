<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>碧蓝档案轴计算器</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3E%E2%8F%B3%3C/text%3E%3C/svg%3E" type="image/svg+xml">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="./src/css/main.css?v=1.0.2">
    <link rel="stylesheet" href="./src/css/rule-styles.css?v=1.0.2">
    <!-- 下拉菜单组件将通过模块加载 -->
    
    <!-- 导航栏滚动效果脚本 -->
    <script>
        // 添加导航栏滚动效果
        window.addEventListener('scroll', function() {
            const header = document.querySelector('.app-header');
            if (window.scrollY > 10) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        
        // 初始化导航栏状态
        window.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('.app-header');
            if (window.scrollY > 10) {
                header.classList.add('scrolled');
            }
        });
        
        // 检测设备类型并自动缩放网页布局
        function autoScalePage() {
            // 检测是否为移动设备或平板设备
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isTablet = /iPad|Android(?!.*Mobile)/i.test(navigator.userAgent);
            
            if (isMobile || isTablet) {
                // 获取屏幕宽度和高度
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                
                // 设置合适的缩放比例
                // 假设桌面布局的最小宽度为1024px
                const scale = Math.min(screenWidth / 1024, 1);
                
                // 调整视口设置
                const viewport = document.querySelector('meta[name=viewport]');
                if (viewport) {
                    viewport.content = `width=device-width, initial-scale=${scale}`;
                }
            }
        }
        
        // 页面加载时执行自动缩放
        window.addEventListener('DOMContentLoaded', autoScalePage);
        // 窗口大小变化时重新执行自动缩放
        window.addEventListener('resize', autoScalePage);
    </script>
    
    <!-- 简单的CSS样式，确保下拉菜单可见 -->
    <style>
        .menu-dropdown {
            display: none;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 120px;
        }
        
        .menu-dropdown.show {
            display: block;
        }
        
        .menu-dropdown-item {
            display: block;
            width: 100%;
            padding: 8px 16px;
            text-align: left;
            background: none;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .menu-dropdown-item:hover {
            background-color: #f5f5f5;
        }
        
        /* 初始化弹窗样式 */
        .modal-backdrop.show {
            display: flex;
        }
        
        /* 内联玻璃态效果样式，确保在GitHub Pages上生效 */
        .modal-backdrop .modal-content {
            /* 玻璃态核心样式 - 添加浏览器前缀以确保兼容性 */
            background: rgba(249, 250, 251, 0.75) !important;
            background-clip: padding-box !important;
            -webkit-backdrop-filter: blur(16px) isolate;
            backdrop-filter: blur(16px) isolate;
            /* 质感装饰 */
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 16px !important;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.05),
                0 12px 32px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.5)
                !important;
            /* 渐变背景增强玻璃质感 */
            background-image: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(240, 249, 255, 0.6) 100%) !important;
            /* 确保元素层级正确 */
            position: relative !important;
            z-index: 1050 !important;
        }
        
        .modal-backdrop .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.4) !important;
            padding-bottom: 1rem !important;
            margin-bottom: 1.5rem !important;
        }
        
        .modal-backdrop .modal-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.4) !important;
            padding-top: 1rem !important;
            margin-top: 1.5rem !important;
        }
        
        /* 角色预设弹窗玻璃态效果 */
        #characterPresetsModal .modal-content {
            /* 玻璃态核心样式 - 优化后 */
            background: rgba(249, 250, 251, 0.7) !important;
            backdrop-filter: blur(16px) isolate !important;
            /* 质感装饰 */
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 16px !important;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.05),
                0 12px 32px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.5)
                !important;
        }
        
        #characterPresetsModal #presetsList .flex {
            /* 列表项玻璃态效果 */
            background: rgba(255, 255, 255, 0.5) !important;
            backdrop-filter: blur(12px) isolate !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 12px !important;
        }
    </style>

</head>
<body style="background-color: #F9FAFB !important; color: #111827 !important;">
    <!-- 顶部导航栏 -->
    <header class="app-header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-calculator"></i>
                <h1>碧蓝档案轴计算器</h1>
            </div>
            
            <!-- 菜单 - 使用语义化标签重构 -->
            <nav class="nav-menu">
                <ul class="flex items-center gap-6 list-none p-0 m-0">
                    <!-- 文件菜单 -->
                    <li class="relative">
                        <button id="fileMenuBtn" class="menu-button" 
                            aria-haspopup="true" aria-expanded="false" aria-controls="fileMenu">
                            <i class="fas fa-file"></i>
                            <span>文件</span>
                            <i class="fas fa-caret-down text-xs"></i>
                        </button>
                        <ul id="fileMenu" class="menu-dropdown absolute right-0 mt-2 list-none p-0 m-0" role="menu" aria-labelledby="fileMenuBtn">
                            <li role="none">
                                <button id="saveProject" class="menu-dropdown-item" role="menuitem">
                                    <i class="fas fa-save"></i>临时保存
                                </button>
                            </li>
                            <li role="none">
                                <button id="loadProject" class="menu-dropdown-item" role="menuitem">
                                    <i class="fas fa-folder-open"></i>加载临时
                                </button>
                            </li>
                            <li role="none">
                                <hr class="my-1 border-gray-200">
                            </li>
                            <li role="none">
                                <button id="exitApp" class="menu-dropdown-item text-danger" role="menuitem">
                                    <i class="fas fa-sign-out"></i>退出
                                </button>
                            </li>
                        </ul>
                    </li>
                    
                    <!-- 编辑菜单 -->
                    <li class="relative">
                        <button id="editMenuBtn" class="menu-button" 
                            aria-haspopup="true" aria-expanded="false" aria-controls="editMenu">
                            <i class="fas fa-pencil"></i>
                            <span>编辑</span>
                            <i class="fas fa-caret-down text-xs"></i>
                        </button>
                        <ul id="editMenu" class="menu-dropdown absolute right-0 mt-2 list-none p-0 m-0" role="menu" aria-labelledby="editMenuBtn">
                            <li role="none">
                                <hr class="my-1 border-gray-200">
                            </li>
                            <li role="none">
                                <button id="undoAction" class="menu-dropdown-item" role="menuitem" disabled>
                                    <i class="fas fa-undo"></i>撤销
                                </button>
                            </li>
                            <li role="none">
                                <button id="redoAction" class="menu-dropdown-item" role="menuitem" disabled>
                                    <i class="fas fa-repeat"></i>重做
                                </button>
                            </li>
                        </ul>
                    </li>
                    
                    <!-- 工具菜单 -->
                    <li class="relative">
                        <button id="toolsMenuBtn" class="menu-button" 
                            aria-haspopup="true" aria-expanded="false" aria-controls="toolsMenu">
                            <i class="fas fa-wrench"></i>
                            <span>工具</span>
                            <i class="fas fa-caret-down text-xs"></i>
                        </button>
                        <ul id="toolsMenu" class="menu-dropdown absolute right-0 mt-2 list-none p-0 m-0" role="menu" aria-labelledby="toolsMenuBtn">
                            <li role="none">
                                <button id="characterPresets" class="menu-dropdown-item" role="menuitem">
                                    <i class="fas fa-star"></i>角色预设
                                </button>
                            </li>
                            <li role="none">
                                <button id="timelineViewBtn" class="menu-dropdown-item" role="menuitem">
                                    <i class="fas fa-clock"></i>时间轴视图
                                </button>
                            </li>

                        </ul>
                    </li>
                    
                    <!-- 帮助菜单 -->
                    <li class="relative">
                        <button id="helpMenuBtn" class="menu-button" 
                            aria-haspopup="true" aria-expanded="false" aria-controls="helpMenu">
                            <i class="fas fa-question-circle"></i>
                            <span>帮助</span>
                            <i class="fas fa-caret-down text-xs"></i>
                        </button>
                        <ul id="helpMenu" class="menu-dropdown absolute right-0 mt-2 list-none p-0 m-0" role="menu" aria-labelledby="helpMenuBtn">
                            <li role="none">
                                <button id="userManual" class="menu-dropdown-item" role="menuitem">
                                    <i class="fas fa-book"></i>使用手册
                                </button>
                            </li>
                            <li role="none">
                                <button id="aboutApp" class="menu-dropdown-item" 
                                        role="menuitem">
                                    <i class="fas fa-info-circle mr-2"></i>关于
                                </button>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </header>


    <!-- 主要内容区域 -->
    <main class="main-content container mx-auto px-4 sm:px-6 py-6">
        <!-- 左侧角色属性面板 -->
        <section class="panel left-panel bg-white rounded-xl shadow-lg border border-gray-100 p-6 flex flex-col">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold flex items-center gap-2 text-gray-800">
                    <i class="fas fa-users text-primary"></i>
                    角色属性
                </h2>
                <div class="flex gap-3">
                    <button id="add-character-btn" class="btn-primary py-2 px-4 rounded-lg hover:shadow-md transition-all">
                        <i class="fas fa-plus"></i>
                        <span>添加</span>
                    </button>

                </div>
            </div>
            
            <!-- 角色列表 -->
            <div class="flex-grow overflow-auto mb-4">
                <table id="charactersTable" class="w-full">
                    <!-- 角色列表将通过JavaScript动态生成 -->
                </table>
            </div>
            
            <!-- 持续回费功能按钮 -->
            <button id="skillBindingBtn" class="btn-primary w-full mb-3">
                <i class="fas fa-bolt"></i>
                持续回费功能
            </button>
            
            <!-- 角色特殊技能按钮 -->
            <button id="specialSkillsBtn" class="btn-primary w-full mb-3">
                <i class="fas fa-star"></i>
                角色特殊技能
            </button>
            <!-- 使用手册按钮 -->
            <button id="manualBtn" class="btn-outline w-full">
                <i class="fas fa-book"></i>
                使用手册
            </button>
        </section>
        
        <!-- 中间数据管理面板 -->
        <section class="panel middle-panel bg-white rounded-xl shadow-lg border border-gray-100 p-6 flex flex-col">
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                <h2 class="text-xl font-semibold flex items-center gap-2 text-gray-800 dark:text-white">
                    <i class="fas fa-table text-primary"></i>
                    数据管理
                </h2>
                <div class="flex gap-3">
                    <button id="refreshTableBtn" class="btn-primary py-2 px-4 rounded-lg hover:shadow-md transition-all">
                        <i class="fas fa-refresh"></i>
                        <span>刷新</span>
                    </button>
                </div>
            </div>
            
            <!-- 数据输入区 - 可折叠 -->
            <div class="mb-4">
                <!-- 添加数据项控制按钮 -->
                <button id="toggleAddItemBtn" class="w-full flex items-center justify-between bg-gray-50 rounded-lg p-2 text-sm font-medium hover:bg-gray-100 transition-colors duration-200">
                    <span class="flex items-center">
                        <i class="fas fa-plus mr-2"></i>
                        添加数据项
                    </span>
                    <i class="fas fa-chevron-up transition-transform duration-200"></i>
                </button>
                
                <!-- 添加数据项内容 - 默认展开 -->
                <div id="addItemContent" class="bg-gray-50 rounded-lg p-4 mt-1">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">触发角色</label>
                            <select id="triggerCharacter" class="input-field w-full character-select">
                                <option value="">请选择角色</option>
                                <!-- 角色选项将通过JavaScript动态生成 -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">触发费用</label>
                            <input type="number" id="triggerCost" class="input-field w-full" min="0" max="10" step="0.01" placeholder="0.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">动作</label>
                            <input type="text" id="action" class="input-field w-full" placeholder="技能/普攻/其他">
                        </div>
                    </div>
                    <div class="mt-3 flex justify-end gap-2">
                        <button id="copyLastItemBtn" class="btn-outline">
                            <i class="fas fa-copy"></i>
                            复制上一项
                        </button>
                        <button id="add-data-item-btn" class="btn-primary">
                            <i class="fas fa-plus"></i>
                            添加数据项
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 角色关联设置区 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-2">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-3 py-2 border-b border-gray-100">
                    <div class="flex items-center justify-between">
                        <h3 class="section-title text-blue-800 flex items-center">
                            <i class="fas fa-link mr-1"></i>
                            角色关联设置
                        </h3>
                        <button id="add-rule-btn" class="btn-primary py-1 px-3 rounded-lg hover:shadow-md transition-all duration-200">
                            <i class="fas fa-plus mr-1"></i>
                            <span>添加规则</span>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-0.5">设置角色间的关联规则，影响费用计算和回费效果</p>
                </div>
                <div id="rulesTable" class="p-2 overflow-y-auto bg-white"></div>
            </div>
            
            <!-- 数据筛选功能 - 可折叠 -->
            <div class="mb-2">
                <!-- 筛选控制按钮 -->
                <button id="toggleFilterBtn" class="w-full flex items-center justify-between bg-gray-50 rounded-lg p-2 text-sm font-medium hover:bg-gray-100 transition-colors duration-200">
                    <span class="flex items-center">
                        <i class="fas fa-filter mr-2"></i>
                        数据筛选
                    </span>
                    <i class="fas fa-chevron-down transition-transform duration-200"></i>
                </button>
                
                <!-- 筛选内容 - 默认隐藏 -->
                <div id="filterContent" class="bg-gray-50 rounded-lg p-2 mt-1 hidden">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                        <div>
                            <label class="block text-xs font-medium mb-1">按角色筛选</label>
                            <select id="filterCharacter" class="input-field w-full character-select text-sm">
                                <option value="">全部角色</option>
                                <!-- 角色选项将通过JavaScript动态生成 -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">开始时间</label>
                            <input type="text" id="filterStartTime" class="input-field w-full time-input text-sm" placeholder="00:00.000">
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">结束时间</label>
                            <input type="text" id="filterEndTime" class="input-field w-full time-input text-sm" placeholder="00:00.000">
                        </div>
                    </div>
                    <div class="mt-2 flex justify-end gap-2">
                        <button id="applyFilterBtn" class="btn-primary text-xs py-1 px-3">
                            <i class="fas fa-filter"></i>
                            应用
                        </button>
                        <button id="clearFilterBtn" class="btn-clear text-xs py-1 px-3">
                            <i class="fas fa-times"></i>
                            清除
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 数据表 -->
            <div class="flex-grow overflow-auto">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2">
                        <h3 class="font-medium">数据表</h3>
                        <button id="toggleSpecialRowsBtn" class="text-sm px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 transition-colors duration-200">
                            <i class="fas fa-eye-slash"></i> 隐藏特殊行
                        </button>
                    </div>

                </div>
                <div class="overflow-x-auto">
                    <table id="dataItemsTable" class="w-full">
                        <!-- 数据项列表将通过JavaScript动态生成 -->
                    </table>
                </div>
            </div>
        </section>
        
        <!-- 右侧操作面板 -->
        <section class="panel right-panel bg-white rounded-xl shadow-lg border border-gray-100 p-6 flex flex-col">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold flex items-center gap-2 text-gray-800 dark:text-white">
                    <i class="fas fa-sliders text-primary"></i>
                    操作面板
                </h2>
            </div>
            
            <!-- 操作按钮 -->
            <div class="flex flex-col gap-3 mb-6">
                <button id="refreshBtn" class="btn-primary">
                    <i class="fas fa-refresh"></i>
                    刷新数据表
                </button>

                <button id="importBtn" class="btn-secondary">
                    <i class="fas fa-upload"></i>
                    导入数据文件
                </button>
                <input type="file" id="importFileInput" accept=".json" style="display: none;">
                <button id="exportBtn" class="btn-secondary">
                    <i class="fas fa-download"></i>
                    导出数据文件
                </button>
                <button id="initializeBtn" class="btn-accent">
                    <i class="fas fa-play"></i>
                    初始化数据表
                </button>
            </div>
            
            <!-- 状态信息 -->
            <div class="bg-gray-50 rounded-lg p-4 flex-grow">
                <h3 class="font-medium mb-3">状态信息</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">初始化状态:</span>
                        <span id="initStatus" class="font-medium text-danger">未初始化</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">角色数量:</span>
                        <span id="characterCount" class="font-medium">0/6</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">数据项数量:</span>
                        <span id="dataItemCount" class="font-medium">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">关联规则数量:</span>
                        <span id="ruleCount" class="font-medium">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">当前时间:</span>
                        <span id="currentTime" class="font-medium">--:--.---</span>
                    </div>
                </div>
            </div>
        </section>
    </main>


    <!-- 页脚 -->
    <footer class="bg-white shadow-inner py-4">
        <div class="container mx-auto px-4 text-center text-gray-600 text-sm">
            <p>© 2025 碧蓝档案轴计算器 | 版本 2.0.0</p>
        </div>
    </footer>


    <!-- 弹窗组件 -->
    <!-- 角色预设弹窗 -->
    <div id="characterPresetsModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content max-w-lg">
            <div class="modal-header">
                <h3 class="text-lg font-semibold">角色预设</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="space-y-4">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-medium">预设角色列表</h4>
                        <div class="text-sm text-gray-500">
                            已添加: <span id="presetCount">0</span>/6
                        </div>
                    </div>
                    <div id="presetsList" class="space-y-3 max-h-60 overflow-y-auto">
                        <!-- 预设角色将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- 添加角色弹窗 -->
    <div id="addCharacterModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-semibold">添加角色</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addCharacterForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">角色名</label>
                        <input type="text" id="characterName" class="input-field w-full" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">回费速度 (c/s)</label>
                        <input type="number" id="characterChargeSpeed" class="input-field w-full" min="0" step="0.01" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">技能费用 (c)</label>
                        <input type="number" id="characterSkillCost" class="input-field w-full" min="0" max="10" step="0.01" required>
                    </div>
                    <div>
                        <div class="form-check mb-1">
                            <input type="checkbox" id="isChargePercentage" class="form-check-input">
                            <label for="isChargePercentage" class="form-check-label font-medium">启用回费</label>
                        </div>
                        <div class="pl-6">
                            <label class="block text-sm font-medium mb-1">回费增加百分比 (%)</label>
                            <input type="number" id="characterChargeIncrease" class="input-field w-full" min="0" step="0.01">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="closeModal btn-outline">取消</button>
                <button id="saveCharacterBtn" type="submit" form="addCharacterForm" class="btn-primary">保存</button>
            </div>
        </div>
    </div>

    <!-- 编辑角色弹窗 -->
    <div id="editCharacterModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-semibold">编辑角色</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editCharacterForm" class="space-y-4">
                    <input type="hidden" id="edit-character-id">
                    <div>
                        <label class="block text-sm font-medium mb-1">角色名</label>
                        <input type="text" id="edit-character-name" class="input-field w-full" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">回费速度 (c/s)</label>
                        <input type="number" id="edit-character-cost-recovery-rate" class="input-field w-full" min="0" step="0.01" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">技能费用 (c)</label>
                        <input type="number" id="edit-character-skill-cost" class="input-field w-full" min="0" max="10" step="0.01" required>
                    </div>
                    <div>
                        <div class="form-check mb-1">
                            <input type="checkbox" id="edit-is-charge-percentage" class="form-check-input">
                            <label for="edit-is-charge-percentage" class="form-check-label font-medium">启用回费</label>
                        </div>
                        <div class="pl-6">
                            <label class="block text-sm font-medium mb-1">回费增加百分比 (%)</label>
                            <input type="number" id="edit-character-cost-increase" class="input-field w-full" min="0" step="0.01">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="closeModal btn-outline">取消</button>
                <button id="saveEditCharacterBtn" type="submit" form="editCharacterForm" class="btn-primary">保存</button>
            </div>
        </div>
    </div>


    <!-- 编辑关联规则弹窗 -->
    <div id="addRuleModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-semibold">添加关联规则</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addRuleForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">规则类型</label>
                        <select id="ruleType" name="ruleType" class="input-field w-full">
                            <option value="">请选择规则类型</option>
                            <option value="costReduction">减费效果</option>


                            <option value="costChange">更改扣除</option>
                            <option value="chargeIncrease">费用效果</option>
                        </select>
                    </div>
                    <!-- 通用字段 -->
                    <div id="ruleSourceCharacterContainer" class="hidden">
                        <label class="block text-sm font-medium mb-1">触发角色</label>
                        <select id="ruleSourceCharacter" name="ruleSourceCharacter" class="input-field w-full">
                            <option value="">请选择角色</option>
                            <!-- 角色选项将通过JavaScript动态生成 -->
                        </select>
                    </div>
                    
                    <!-- 减费效果字段 -->
                    <div id="costReductionFields" class="hidden">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">目标角色</label>
                            <select id="crTargetCharacter" name="crTargetCharacter" class="input-field w-full">
                                <option value="">请选择角色</option>
                                <!-- 角色选项将通过JavaScript动态生成 -->
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">生效次数</label>
                            <input type="number" id="crEffectCount" name="crEffectCount" class="input-field w-full" min="1" max="10" step="1">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">减费数值</label>
                            <input type="number" id="crValue" name="crValue" class="input-field w-full" min="0" max="10" step="0.01">
                        </div>
                    </div>
                    

                    

                    
                    <!-- 更改扣除字段 -->
                    <div id="costChangeFields" class="hidden">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">更改数值</label>
                            <input type="number" id="ccValue" name="ccValue" class="input-field w-full" step="0.01">
                        </div>
                    </div>
                    
                    <!-- 回费效果字段 -->
                    <div id="chargeIncreaseFields" class="hidden">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">生效时间 (秒)</label>
                            <input type="number" id="ciActivationTime" name="ciActivationTime" class="input-field w-full" min="0" step="0.01">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">持续时间 (秒)</label>
                            <input type="number" id="ciDuration" name="ciDuration" class="input-field w-full" min="0" step="0.01">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">费用类型</label>
                            <select id="ciChargeType" name="ciChargeType" class="input-field w-full">
                                <option value="percentage">百分比</option>
                                <option value="fixed">固定数值</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">费用数值</label>
                            <input type="number" id="ciValue" name="ciValue" class="input-field w-full" step="0.01">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">效果类型</label>
                            <select id="ciEffectType" name="ciEffectType" class="input-field w-full">
                                <option value="increase">增加</option>
                                <option value="decrease">减少</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">作用范围</label>
                            <div id="ciTargetScopeContainer" class="grid grid-cols-2 gap-2">
                                <!-- 角色多选选项将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="closeModal btn-outline">取消</button>
                <button id="saveRuleBtn" class="btn-primary" type="submit" form="addRuleForm">保存</button>
            </div>
        </div>
    </div>




    <!-- 编辑数据项弹窗 -->
    <div id="editDataItemModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-semibold">编辑数据项</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editDataItemForm" class="space-y-4">
                    <input type="hidden" id="editDataItemId">
                    <div>
                        <label class="block text-sm font-medium mb-1">触发角色</label>
                        <select id="editTriggerCharacter" class="input-field w-full character-select" required>
                            <option value="">请选择角色</option>
                            <!-- 角色选项将通过JavaScript动态生成 -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">触发费用</label>
                        <input type="number" id="editTriggerCost" class="input-field w-full" min="0" max="10" step="0.01" placeholder="0.00" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">动作</label>
                        <input type="text" id="editAction" class="input-field w-full" placeholder="技能/普攻/其他" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">时间</label>
                        <input type="text" id="editTime" class="input-field w-full time-input" placeholder="00:00.000" required>
                        <p class="text-xs text-gray-500 mt-1">提示：修改时间会自动计算触发费用，修改触发费用会自动计算时间，两者相互影响</p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="closeModal btn-outline">取消</button>
                <button id="saveDataItemBtn" class="btn-primary" type="submit" form="editDataItemForm">保存</button>
            </div>
        </div>
    </div>





    <!-- 时间轴视图弹窗 -->
    <div id="timelineModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content large timeline-modal">
            <div class="modal-header bg-gradient-to-r from-blue-600 to-purple-600 text-white">
                <div class="flex items-center gap-2">
                    <i class="fas fa-clock text-xl"></i>
                    <h3 class="text-xl font-bold">时间轴视图</h3>
                </div>
                <button class="closeModal text-white hover:text-gray-200 transition-colors duration-300">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- 数据概览卡片 -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="stats-card bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-blue-600 font-medium">技能释放次数</p>
                                <h3 id="timelineTotalActions" class="text-2xl font-bold text-blue-800">0</h3>
                            </div>
                            <div class="bg-blue-200 rounded-full p-3 text-blue-700">
                                <i class="fas fa-bolt text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stats-card bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-purple-600 font-medium">总触发费用</p>
                                <h3 id="timelineTotalCost" class="text-2xl font-bold text-purple-800">0.00c</h3>
                            </div>
                            <div class="bg-purple-200 rounded-full p-3 text-purple-700">
                                <i class="fas fa-money-bill-wave text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 双栏布局容器 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 费用变化曲线 -->
                    <div class="h-full flex flex-col">
                        <div class="card-header flex justify-between items-center mb-3">
                            <h4 class="font-semibold text-gray-800 flex items-center gap-2">
                                <i class="fas fa-chart-line text-blue-600"></i>
                                费用变化曲线
                            </h4>
                            <div class="chart-controls flex gap-2">
                                <button id="toggleChartType" class="chart-control-btn bg-blue-50 text-blue-700 px-3 py-1 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors duration-300">
                                    <i class="fas fa-swap-horizontal"></i>
                                    <span>切换图表类型</span>
                                </button>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-5 border border-gray-200 shadow-md chart-container flex-1">
                            <div class="h-full relative">
                                <canvas id="costChart"></canvas>
                                <!-- 加载动画 -->
                                <div id="chartLoading" class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-70 rounded-lg hidden">
                                    <div class="loader-spinner animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-600"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 技能释放时间轴 -->
                    <div class="h-full flex flex-col">
                        <div class="card-header flex justify-between items-center mb-3">
                            <h4 class="font-semibold text-gray-800 flex items-center gap-2">
                                <i class="fas fa-calendar-alt text-purple-600"></i>
                                技能释放时间轴
                            </h4>
                            <div class="timeline-controls flex gap-2">
                                <button id="filterByCharacter" class="timeline-control-btn bg-purple-50 text-purple-700 px-3 py-1 rounded-lg text-sm font-medium hover:bg-purple-100 transition-colors duration-300">
                                    <i class="fas fa-filter"></i>
                                    <span>按角色筛选</span>
                                </button>
                                <button id="clearTimelineFilter" class="timeline-control-btn bg-gray-50 text-gray-700 px-3 py-1 rounded-lg text-sm font-medium hover:bg-gray-100 transition-colors duration-300 hidden">
                                    <i class="fas fa-times"></i>
                                    <span>清除筛选</span>
                                </button>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-5 border border-gray-200 shadow-md flex-1 overflow-hidden">
                            <div id="timelineEvents" class="relative h-full overflow-y-auto pr-2">
                                <!-- 时间轴事件将通过JavaScript动态生成 -->
                                <div class="timeline-empty-state text-center py-12">
                                    <div class="bg-gray-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-clock text-4xl text-gray-400"></i>
                                    </div>
                                    <h5 class="text-lg font-semibold text-gray-800 mb-1">暂无技能释放数据</h5>
                                    <p class="text-gray-500">请先添加数据项以查看时间轴</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-gray-50 border-t border-gray-200">
                <button class="closeModal btn-primary w-full sm:w-auto">
                    <i class="fas fa-times mr-2"></i>
                    关闭
                </button>
            </div>
        </div>
    </div>
    
    <!-- 角色筛选下拉菜单 -->
    <div id="characterFilterDropdown" class="absolute z-50 bg-white rounded-xl shadow-xl border border-gray-200 py-2 hidden"></div>
    
    <!-- 样式 -->
    <style>
        .timeline-modal {
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .timeline-modal .modal-body {
            overflow-y: auto;
            flex: 1;
        }
        
        .stats-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chart-container {
            transition: all 0.3s ease;
        }
        
        .chart-container:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .chart-control-btn,
        .timeline-control-btn {
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* 时间轴样式 */
        .timeline-events-container {
            position: relative;
        }
        
        .timeline-line {
            position: absolute;
            left: 12px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #3b82f6, #8b5cf6, #ec4899);
        }
        
        .timeline-item {
            position: relative;
            padding-left: 40px;
            margin-bottom: 1.5rem;
            opacity: 0;
            transform: translateX(-20px);
            animation: timelineItemFadeIn 0.5s ease forwards;
        }
        
        @keyframes timelineItemFadeIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .timeline-item:nth-child(1) {
            animation-delay: 0.1s;
        }
        
        .timeline-item:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .timeline-item:nth-child(3) {
            animation-delay: 0.3s;
        }
        
        .timeline-item:nth-child(4) {
            animation-delay: 0.4s;
        }
        
        .timeline-item:nth-child(5) {
            animation-delay: 0.5s;
        }
        
        .timeline-item:nth-child(n+6) {
            animation-delay: 0.6s;
        }
        
        .timeline-marker {
            position: absolute;
            left: 0;
            top: 0;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: 4px solid white;
            border-radius: 50%;
            box-shadow: 0 0 0 2px #3b82f6, 0 2px 8px rgba(59, 130, 246, 0.3);
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .timeline-item:hover .timeline-marker {
            transform: scale(1.2);
            box-shadow: 0 0 0 3px #3b82f6, 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .timeline-content {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .timeline-content::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
            transform: scaleY(0);
            transform-origin: top;
            transition: transform 0.3s ease;
        }
        
        .timeline-item:hover .timeline-content {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .timeline-item:hover .timeline-content::before {
            transform: scaleY(1);
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }
        
        .timeline-title {
            font-weight: 500;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .timeline-title i {
            font-size: 0.875rem;
        }
        
        .timeline-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .timeline-meta-item {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.875rem;
            color: #6b7280;
            background: #f3f4f6;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }
        
        .timeline-meta-item i {
            font-size: 0.75rem;
        }
        
        .timeline-cost-badge {
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }
        
        .timeline-number {
            background: #f3f4f6;
            color: #374151;
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }
        
        .timeline-empty-state {
            color: #9ca3af;
            transition: all 0.3s ease;
        }
        
        /* 图表样式 */
        .chart-container {
            transition: all 0.3s ease;
        }
        
        .chart-container:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }
        
        /* 加载动画 */
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        /* 响应式设计 */
        @media (max-width: 1024px) {
            .timeline-modal {
                max-width: 95vw;
                max-height: 95vh;
            }
            
            .grid-cols-1 lg:grid-cols-2 {
                grid-template-columns: 1fr;
            }
            
            .h-80 {
                height: 300px;
            }
        }
        
        @media (max-width: 768px) {
            .timeline-modal {
                max-width: 95vw;
                max-height: 95vh;
            }
            
            .grid-cols-1 md:grid-cols-3 {
                grid-template-columns: 1fr;
            }
            
            .h-80 {
                height: 240px;
            }
            
            .chart-controls, .timeline-controls {
                flex-wrap: wrap;
            }
            
            .chart-control-btn, .timeline-control-btn {
                font-size: 12px;
                padding: 0.25rem 0.5rem;
            }
        }
    </style>


    <!-- 使用手册弹窗 - 横版布局 -->
    <div id="manualModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content manual-modal横版">
            <div class="modal-header">
                <h3 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-book mr-2"></i>使用手册
                </h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            <div class="modal-body manual-layout横版">
                <!-- 左侧导航区域 -->
                <aside class="manual-nav-sidebar">
                    <!-- 封面信息 -->
                    <div class="manual-nav-header p-5 bg-gradient-to-b from-blue-50 to-purple-50 border-b border-blue-100 flex items-center justify-center">
                        <div class="text-center">
                            <h4 class="font-bold text-gray-900 text-lg">碧蓝档案轴计算器</h4>
                            <p class="text-xs text-gray-600">专业的技能释放规划工具</p>
                        </div>
                    </div>
                    
                    <!-- 目录导航 -->
                    <nav class="manual-nav-content p-4 overflow-y-auto">
                        <h5 class="text-sm font-semibold text-gray-500 uppercase mb-3 flex items-center">
                            <i class="fas fa-list mr-2 text-gray-400"></i>目录
                        </h5>
                        <ul class="space-y-1">
                            <li>
                                <a href="#manual-quickstart" class="manual-nav-item flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg transition-colors">
                                    <i class="fas fa-rocket mr-2 text-xs text-blue-500"></i>
                                    <span>快速开始</span>
                                </a>
                            </li>
                            <li>
                                <a href="#manual-features" class="manual-nav-item flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg transition-colors">
                                    <i class="fas fa-star mr-2 text-xs text-yellow-500"></i>
                                    <span>核心功能</span>
                                </a>
                            </li>
                            <li>
                                <a href="#manual-editing" class="manual-nav-item flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg transition-colors">
                                    <i class="fas fa-pencil mr-2 text-xs text-green-500"></i>
                                    <span>编辑技巧</span>
                                </a>
                            </li>
                            <li>
                                <a href="#manual-calculation" class="manual-nav-item flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg transition-colors">
                                    <i class="fas fa-calculator mr-2 text-xs text-purple-500"></i>
                                    <span>计算规则</span>
                                </a>
                            </li>
                            <li>
                                <a href="#manual-time" class="manual-nav-item flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg transition-colors">
                                    <i class="fas fa-clock mr-2 text-xs text-orange-500"></i>
                                    <span>时间格式</span>
                                </a>
                            </li>
                            <li>
                                <a href="#manual-intro" class="manual-nav-item flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg transition-colors">
                                    <i class="fas fa-info-circle mr-2 text-xs text-gray-400"></i>
                                    <span>基本介绍</span>
                                </a>
                            </li>
                            <li>
                                <a href="#manual-notes" class="manual-nav-item flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg transition-colors">
                                    <i class="fas fa-exclamation-circle mr-2 text-xs text-red-500"></i>
                                    <span>注意事项</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </aside>
                
                <!-- 右侧内容区域 -->
                <main class="manual-content-area overflow-y-auto">
                    <!-- 内容容器 -->
                    <div class="manual-content-container p-6">
                        <!-- 快速开始指南 -->
                        <section id="manual-quickstart" class="manual-section mb-12">
                            <div class="section-header mb-6">
                                <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                                    <i class="fas fa-rocket mr-3 text-yellow-500"></i>
                                    快速开始指南
                                </h2>
                                <div class="h-1 w-20 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mt-2"></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                                <ol class="space-y-5">
                                    <li class="flex gap-4">
                                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center font-medium text-sm shadow-sm">1</div>
                                        <div class="flex-1">
                                            <h3 class="font-semibold text-gray-900 mb-1">添加角色</h3>
                                            <p class="text-gray-600">点击"添加角色"按钮，设置角色名、回费速度、技能费用等属性</p>
                                        </div>
                                    </li>
                                    <li class="flex gap-4">
                                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center font-medium text-sm shadow-sm">2</div>
                                        <div class="flex-1">
                                            <h3 class="font-semibold text-gray-900 mb-1">初始化数据表</h3>
                                            <p class="text-gray-600">点击"初始化"按钮，设置初始时间（如2:59.000）。<strong>初始时间代表开始回费的时间，而不是场景最开始的时间</strong></p>
                                        </div>
                                    </li>
                                    <li class="flex gap-4">
                                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center font-medium text-sm shadow-sm">3</div>
                                        <div class="flex-1">
                                            <h3 class="font-semibold text-gray-900 mb-1">添加数据项</h3>
                                            <p class="text-gray-600">在中间表单选择触发角色、输入触发费用、动作，点击"添加数据项"</p>
                                        </div>
                                    </li>
                                    <li class="flex gap-4">
                                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center font-medium text-sm shadow-sm">4</div>
                                        <div class="flex-1">
                                            <h3 class="font-semibold text-gray-900 mb-1">编辑数据项</h3>
                                            <p class="text-gray-600">点击数据项后的编辑按钮，可调整时间或费用，系统会自动计算关联数据</p>
                                        </div>
                                    </li>
                                    <li class="flex gap-4">
                                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center font-medium text-sm shadow-sm">5</div>
                                        <div class="flex-1">
                                            <h3 class="font-semibold text-gray-900 mb-1">设置关联规则</h3>
                                            <p class="text-gray-600">选择目标行后，点击"添加关联规则"，设置角色间的相互影响</p>
                                        </div>
                                    </li>
                                    <li class="flex gap-4">
                                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center font-medium text-sm shadow-sm">6</div>
                                        <div class="flex-1">
                                            <h3 class="font-semibold text-gray-900 mb-1">使用撤销/重做</h3>
                                            <p class="text-gray-600">点击"撤销"按钮可以回退上一步操作，点击"重做"按钮可以恢复已撤销的操作</p>
                                        </div>
                                    </li>
                                    <li class="flex gap-4">
                                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center font-medium text-sm shadow-sm">7</div>
                                        <div class="flex-1">
                                            <h3 class="font-semibold text-gray-900 mb-1">复制最后一项</h3>
                                            <p class="text-gray-600">点击"复制最后一项"按钮可以快速复制最后一条数据项，系统会自动更新时间</p>
                                        </div>
                                    </li>
                                </ol>
                            </div>
                        </section>
                        
                        <!-- 核心功能说明 -->
                        <section id="manual-features" class="manual-section mb-12">
                            <div class="section-header mb-6">
                                <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                                    <i class="fas fa-star mr-3 text-yellow-500"></i>
                                    核心功能说明
                                </h2>
                                <div class="h-1 w-20 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mt-2"></div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- 角色管理 -->
                                <div class="feature-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-all">
                                    <div class="feature-icon w-12 h-12 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center mb-4 shadow-sm">
                                        <i class="fas fa-users text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-3">角色管理</h3>
                                    <ul class="space-y-2">
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>添加、编辑、删除角色（最多6个）</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>设置角色回费速度、技能费用</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>启用回费：配置回费增加百分比，该百分比会应用到所有角色的回费计算</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>最多只有一个角色可以启用回费功能</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>角色预设：内置12个预设角色，可快速添加常用角色</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <!-- 数据管理 -->
                                <div class="feature-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-all">
                                    <div class="feature-icon w-12 h-12 bg-purple-100 text-purple-600 rounded-xl flex items-center justify-center mb-4 shadow-sm">
                                        <i class="fas fa-table text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-3">数据管理</h3>
                                    <ul class="space-y-2">
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>添加、编辑、删除数据项</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>自动计算时间间隔和费用</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>实时更新剩余费用</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>支持数据导入导出（JSON格式）</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>撤销/重做功能：支持所有操作的撤销和重做，最多保存50步历史记录</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>复制最后一项功能：快速复制最后一条数据项，自动更新时间</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <!-- 关联规则 -->
                                <div class="feature-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                    <div class="feature-icon w-12 h-12 bg-green-100 text-green-600 rounded-xl flex items-center justify-center mb-4">
                                        <i class="fas fa-link text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-3">关联规则</h3>
                                    <div class="mb-3 text-sm text-gray-600">
                                        <strong>使用步骤</strong>：选择目标行 → 点击"添加规则" → 设置参数 → 保存
                                    </div>
                                    <ul class="space-y-3">
                                        <li class="p-3 bg-green-50 rounded-lg border border-green-100">
                                            <h4 class="font-medium text-green-800 mb-1">减费效果</h4>
                                            <p class="text-sm text-gray-700">降低目标角色的技能费用</p>
                                            <div class="mt-2 space-y-1 text-xs text-gray-600">
                                                <div><strong>设置项</strong>：触发角色、目标角色、生效次数、减费数值</div>
                                                <div><strong>注意</strong>：后添加的减费规则优先级更高，会覆盖之前的减费效果</div>
                                            </div>
                                        </li>
                                        <li class="p-3 bg-green-50 rounded-lg border border-green-100">
                                            <h4 class="font-medium text-green-800 mb-1">更改扣除</h4>
                                            <p class="text-sm text-gray-700">直接修改目标行的费用扣除值</p>
                                            <div class="mt-2 space-y-1 text-xs text-gray-600">
                                                <div><strong>设置项</strong>：触发角色、更改数值</div>
                                                <div><strong>注意</strong>：该规则仅对目标行生效，会覆盖所有其他费用计算</div>
                                            </div>
                                        </li>
                                        <li class="p-3 bg-green-50 rounded-lg border border-green-100">
                                            <h4 class="font-medium text-green-800 mb-1">费用效果</h4>
                                            <p class="text-sm text-gray-700">增加或减少回费速度</p>
                                            <div class="mt-2 space-y-1 text-xs text-gray-600">
                                                <div><strong>设置项</strong>：触发角色、目标角色、生效时间、持续时间、费用类型、数值</div>
                                                <div><strong>注意</strong>：费用效果在指定时间范围内生效，会影响所有符合条件的角色</div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                
                                <!-- 持续回费功能 -->
                                <div class="feature-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                    <div class="feature-icon w-12 h-12 bg-yellow-100 text-yellow-600 rounded-xl flex items-center justify-center mb-4">
                                        <i class="fas fa-bolt text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-3">持续回费功能</h3>
                                    <div class="mb-3 text-sm text-gray-600">
                                        <strong>使用步骤</strong>：选择目标行 → 点击"持续回费功能" → 设置参数 → 保存
                                    </div>
                                    <div class="space-y-3">
                                        <div class="p-3 bg-yellow-50 rounded-lg border border-yellow-100">
                                            <h4 class="font-medium text-yellow-800 mb-2">参数说明</h4>
                                            <div class="space-y-2 text-sm text-gray-700">
                                                <div class="flex items-start gap-2">
                                                    <i class="fas fa-clock text-yellow-600 mt-1"></i>
                                                    <span><strong>延迟时间</strong>：从目标行到回费效果开始的时间间隔（秒）</span>
                                                </div>
                                                <div class="flex items-start gap-2">
                                                    <i class="fas fa-hourglass-half text-yellow-600 mt-1"></i>
                                                    <span><strong>持续时长</strong>：回费效果持续的时间（秒）</span>
                                                </div>
                                                <div class="flex items-start gap-2">
                                                    <i class="fas fa-arrow-up text-yellow-600 mt-1"></i>
                                                    <span><strong>回费速度增加</strong>：回费速度的增加量（c/s），应用于目标角色</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="p-3 bg-blue-50 rounded-lg border border-blue-100">
                                            <h4 class="font-medium text-blue-800 mb-2">效果说明</h4>
                                            <ul class="space-y-1 text-sm text-gray-700">
                                                <li class="flex items-start gap-2">
                                                    <i class="fas fa-check text-blue-600 mt-1"></i>
                                                    <span>在目标行的时间点 - 延迟时间 开始生效</span>
                                                </li>
                                                <li class="flex items-start gap-2">
                                                    <i class="fas fa-check text-blue-600 mt-1"></i>
                                                    <span>持续 一定时长后结束</span>
                                                </li>
                                                <li class="flex items-start gap-2">
                                                    <i class="fas fa-check text-blue-600 mt-1"></i>
                                                    <span>期间目标角色的回费速度增加 指定数值</span>
                                                </li>
                                                <li class="flex items-start gap-2">
                                                    <i class="fas fa-check text-blue-600 mt-1"></i>
                                                    <span>该增加量会受到启用回费功能的百分比加成影响</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 角色特殊技能 -->
                                <div class="feature-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                    <div class="feature-icon w-12 h-12 bg-pink-100 text-pink-600 rounded-xl flex items-center justify-center mb-4">
                                        <i class="fas fa-star text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-3">角色特殊技能</h3>
                                    <div class="mb-3 text-sm text-gray-600">
                                        <strong>使用步骤</strong>：点击"角色特殊技能" → 设置技能 → 保存
                                    </div>
                                    <ul class="space-y-2">
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>设置和计算角色的特殊技能费用</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>特殊技能的费用会自动应用到相关数据项中</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>支持不同角色的特殊技能费用计算</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <!-- 时间轴管理 -->
                                <div class="feature-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow opacity-70">
                                    <div class="feature-icon w-12 h-12 bg-gray-100 text-gray-600 rounded-xl flex items-center justify-center mb-4">
                                        <i class="fas fa-clock text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-3 flex items-center">
                                        时间轴管理
                                        <span class="ml-2 px-2 py-0.5 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">维护中</span>
                                    </h3>
                                    <ul class="space-y-2 text-gray-500">
                                        <li class="flex items-start gap-2">
                                            <i class="fas fa-hourglass-half text-gray-400 mt-1"></i>
                                            <span>可视化展示技能释放时间</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <i class="fas fa-hourglass-half text-gray-400 mt-1"></i>
                                            <span>实时显示费用变化曲线</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <i class="fas fa-hourglass-half text-gray-400 mt-1"></i>
                                            <span>支持时间格式自动转换</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <i class="fas fa-hourglass-half text-gray-400 mt-1"></i>
                                            <span>精准计算回费时间</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <!-- 数据筛选 -->
                                <div class="feature-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                    <div class="feature-icon w-12 h-12 bg-purple-100 text-purple-600 rounded-xl flex items-center justify-center mb-4">
                                        <i class="fas fa-filter text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-3">数据筛选</h3>
                                    <ul class="space-y-2">
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>展开/收起筛选面板，设置筛选条件</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>应用筛选条件，显示符合条件的数据项</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>清空筛选条件，恢复显示所有数据项</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <!-- 分页功能 -->
                                <div class="feature-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                    <div class="feature-icon w-12 h-12 bg-green-100 text-green-600 rounded-xl flex items-center justify-center mb-4">
                                        <i class="fas fa-list-ol text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-3">分页功能</h3>
                                    <ul class="space-y-2">
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>点击首页、上一页、下一页、末页按钮切换页码</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>每页显示10条数据项</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>分页状态会在数据更新时自动重置</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <!-- 隐藏/显示特殊行 -->
                                <div class="feature-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                    <div class="feature-icon w-12 h-12 bg-orange-100 text-orange-600 rounded-xl flex items-center justify-center mb-4">
                                        <i class="fas fa-eye text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-3">隐藏/显示特殊行</h3>
                                    <ul class="space-y-2">
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>点击"隐藏特殊行"按钮可以隐藏回费和减费等特殊行</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>点击"显示特殊行"按钮可以恢复显示所有行</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span>隐藏特殊行不影响数据计算，仅改变显示效果</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </section>
                        
                        <!-- 编辑数据项技巧 -->
                        <section id="manual-editing" class="manual-section">
                            <div class="section-header mb-4">
                                <h2 class="text-2xl font-bold text-gray-900">
                                    编辑数据项技巧
                                </h2>
                                <div class="h-1 w-16 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mt-2"></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                                <div class="mb-6">
                                    <h3 class="text-xl font-semibold text-gray-900 mb-4">实时计算功能</h3>
                                    <p class="text-gray-700 mb-4">
                                        编辑数据项时，系统会根据时间或费用的变化自动计算关联的费用或时间，确保计算结果的准确性和一致性。任何时间或费用的微小变化都会触发自动计算。
                                    </p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                        <div class="p-4 bg-green-50 rounded-lg border border-green-100">
                                            <h4 class="font-medium text-green-800 mb-2 flex items-center">
                                                <i class="fas fa-clock mr-2"></i>修改时间
                                            </h4>
                                            <p class="text-sm text-green-700">
                                                费用会自动计算：<br>
                                                <strong class="text-green-900">时间增加 → 费用减少</strong><br>
                                                <strong class="text-green-900">时间减少 → 费用增加</strong>
                                            </p>
                                            <div class="mt-3 text-xs text-gray-600">
                                                <div><strong>计算逻辑</strong>：使用前一行的剩余费用作为初始费用，基于当前时间和上一个时间的时间间隔，考虑所有关联规则和持续回费效果，使用细粒度时间步长（0.001秒）模拟费用恢复</div>
                                            </div>
                                        </div>
                                        <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                                            <h4 class="font-medium text-blue-800 mb-2 flex items-center">
                                                <i class="fas fa-money mr-2"></i>修改费用
                                            </h4>
                                            <p class="text-sm text-blue-700">
                                                时间会自动计算：<br>
                                                <strong class="text-blue-900">费用增加 → 时间减少</strong><br>
                                                <strong class="text-blue-900">费用减少 → 时间增加</strong>
                                            </p>
                                            <div class="mt-3 text-xs text-gray-600">
                                                <div><strong>计算逻辑</strong>：基于目标费用和前一行的剩余费用差值，考虑所有关联规则和持续回费效果，计算需要的时间，使用细粒度时间步长（0.001秒）模拟费用恢复</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                                        <h4 class="font-medium text-yellow-800 mb-2 flex items-center">
                                            <i class="fas fa-info-circle mr-2"></i>支持的时间格式
                                        </h4>
                                        <p class="text-sm text-yellow-700">
                                            系统支持多种时间格式，自动识别并转换：<br>
                                            <strong>MM:SS.fff</strong>（如02:59.000）、<strong>MM:SS</strong>（如02:59或2:59）、<br>
                                            <strong>SS.fff</strong>（如59.000）、<strong>SS</strong>（如59）、<strong>纯数字</strong>（如179）
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="mb-6">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-3">其他技巧</h3>
                                    <ul class="space-y-2">
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span><strong>修改角色</strong>：系统会重新计算相关数据</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span><strong>动作为空</strong>：自动设置为"技能"</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span><strong>撤销/重做</strong>：支持所有操作的撤销和重做，包括添加、编辑、删除数据项，添加、编辑、删除角色和规则等</span>
                                        </li>
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <i class="fas fa-check text-green-500 mt-1"></i>
                                            <span><strong>复制最后一项</strong>：快速复制最后一条数据项，系统会自动更新时间，费用保持不变</span>
                                        </li>
                                    </ul>
                                </div>
                                
                                <div class="example-box p-5 bg-gray-50 rounded-lg border border-gray-200">
                                    <h3 class="font-medium text-gray-900 mb-3 flex items-center">
                                        <i class="fas fa-file-text-o mr-2 text-gray-600"></i>
                                        示例说明
                                    </h3>
                                    <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm">
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div class="text-center">
                                                <div class="text-sm text-gray-500 mb-1">原状态</div>
                                                <div class="font-mono text-gray-900">触发费用: 3c</div>
                                                <div class="font-mono text-gray-900">时间: 2:59.000</div>
                                                <div class="font-mono text-gray-900">回费速度: 3c/s</div>
                                            </div>
                                            <div class="flex items-center justify-center">
                                                <i class="fas fa-arrow-right text-gray-400 text-xl"></i>
                                            </div>
                                            <div class="space-y-2">
                                                <div class="text-sm text-gray-500 mb-1">修改后</div>
                                                <div class="flex items-center justify-between">
                                                    <span class="font-mono text-gray-900">触发费用: 6c</span>
                                                    <span class="text-sm text-green-600">→</span>
                                                    <span class="font-mono text-gray-900">时间: 2:58.000</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="font-mono text-gray-900">时间: 2:57.000</span>
                                                    <span class="text-sm text-green-600">→</span>
                                                    <span class="font-mono text-gray-900">触发费用: 9c</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- 费用计算规则 -->
                        <section id="manual-calculation" class="manual-section">
                            <div class="section-header mb-4">
                                <h2 class="text-2xl font-bold text-gray-900">
                                    费用计算规则
                                </h2>
                                <div class="h-1 w-16 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mt-2"></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                                <div class="space-y-4">
                                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                                        <h3 class="font-medium text-gray-900 mb-3">基础规则</h3>
                                        <ul class="space-y-2">
                                            <li class="flex items-start gap-2 text-gray-700">
                                                <i class="fas fa-circle text-blue-500 mt-1"></i>
                                                <span><strong>费用上限</strong>：固定为10c，初始费用为0c</span>
                                            </li>
                                        </ul>
                                    </div>
                                    
                                    <div class="calculation-formulas space-y-4">
                                        <h3 class="font-medium text-gray-900">计算公式</h3>
                                        
                                        <!-- 基础回费计算 -->
                                        <div class="formula-item p-4 bg-blue-50 rounded-lg border border-blue-100">
                                            <div class="formula-text font-mono text-gray-900 mb-2">
                                                <strong>基础回费</strong> = 回费速度 × 时间间隔
                                            </div>
                                            <div class="text-sm text-gray-600">
                                                <i class="fas fa-info-circle mr-1"></i>
                                                回费速度受<strong>持续回费规则</strong>影响，可通过关联规则提高
                                            </div>
                                        </div>
                                        
                                        <!-- 总回费计算 -->
                                        <div class="formula-item p-4 bg-purple-50 rounded-lg border border-purple-100">
                                            <div class="formula-text font-mono text-gray-900 mb-2">
                                                <strong>总回费</strong> = (基础回费 + 固定值增加) × (1 + 总回费增加百分比) + Σ瞬间回费数值
                                            </div>
                                            <div class="text-sm text-gray-600">
                                                <i class="fas fa-info-circle mr-1"></i>
                                                回费计算规则说明：
                                                <ul class="list-disc pl-5 mt-1 space-y-1">
                                                    <li>基础回费：角色原始回费速度 × 时间间隔</li>
                                                    <li>固定值增加：来自费用效果规则的固定数值增加，应用于指定角色</li>
                                                    <li>总回费增加百分比：角色属性中的回费增加百分比与费用效果规则的百分比累加</li>
                                                    <li>固定值增加也会受到总回费增加百分比的加成</li>
                                                    <li>角色属性中只有一个角色可以设置回费增加百分比（启用回费）</li>
                                                    <li>该百分比会应用到所有角色的回费计算</li>
                                                    <li>回费效果规则可叠加使用</li>
                                                </ul>
                                            </div>
                                        </div>
                                        
                                        <!-- 实际扣除费用计算 -->
                                        <div class="formula-item p-4 bg-green-50 rounded-lg border border-green-100">
                                            <div class="formula-text font-mono text-gray-900 mb-2">
                                                <strong>实际扣除费用</strong> = max(0, 技能费用 - 减费数值)
                                            </div>
                                            <div class="text-sm text-gray-600">
                                                <i class="fas fa-info-circle mr-1"></i>
                                                减费数值来自<strong>减费效果规则</strong>，后应用的减费效果会覆盖之前的减费效果<br>
                                                <i class="fas fa-info-circle mr-1"></i>
                                                <strong>更改扣除功能</strong>：直接覆盖目标行的费用扣除，使用规则的changeValue作为最终费用
                                            </div>
                                        </div>
                                        
                                        <!-- 剩余费用计算 -->
                                        <div class="formula-item p-4 bg-orange-50 rounded-lg border border-orange-100">
                                            <div class="formula-text font-mono text-gray-900 mb-2">
                                                <strong>剩余费用</strong> = max(0, 触发费用 - 费用扣除)
                                            </div>
                                            <div class="text-sm text-gray-600">
                                                <i class="fas fa-info-circle mr-1"></i>
                                                简化后的剩余费用计算公式，直接用触发费用减去费用扣除
                                            </div>
                                        </div>
                                        
                                        <!-- 关联规则影响说明 -->
                                        <div class="p-4 bg-gray-50 rounded-lg border border-gray-100">
                                            <h4 class="font-medium text-gray-900 mb-2 flex items-center">
                                                <i class="fas fa-link mr-2 text-gray-600"></i>
                                                关联规则对计算的影响
                                            </h4>
                                            <ul class="space-y-3 text-sm text-gray-700">
                                                <li class="flex items-start gap-2">
                                                    <i class="fas fa-check text-green-500 mt-1"></i>
                                                    <span><strong>减费效果</strong>：直接降低技能费用，减少实际扣除费用。可设置生效次数，次数用完后效果消失，角色技能费用恢复原值。<strong>注意：后应用的减费效果会覆盖之前的减费效果，而非叠加</strong></span>
                                                </li>
                                                <li class="flex items-start gap-2">
                                                    <i class="fas fa-check text-green-500 mt-1"></i>
                                                    <span><strong>更改扣除</strong>：直接覆盖目标行的费用扣除数值，使用规则的changeValue作为最终费用</span>
                                                </li>
                                                <li class="flex items-start gap-2">
                                                    <i class="fas fa-check text-green-500 mt-1"></i>
                                                    <span><strong>费用效果</strong>：调整回费效果，可设置时间范围和作用对象：
                                                        <ul class="list-disc pl-5 mt-1 space-y-1">
                                                            <li><strong>固定数值</strong>：直接增加或减少指定角色的回费速度，会受到启用回费的百分比加成影响</li>
                                                            <li><strong>百分比</strong>：增加或减少回费百分比，与角色属性中的启用回费百分比累加</li>
                                                            <li><strong>作用范围</strong>：可选择单个或多个角色应用效果</li>
                                                            <li><strong>时间范围</strong>：在指定的生效时间和持续时长内有效</li>
                                                        </ul>
                                                    </span>
                                                </li>
                                                <li class="flex items-start gap-2">
                                                    <i class="fas fa-check text-green-500 mt-1"></i>
                                                    <span><strong>持续回费</strong>：为指定角色增加持续回费效果，该效果会受到启用回费的百分比加成影响</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- 时间格式说明 -->
                        <section id="manual-time" class="manual-section">
                            <div class="section-header mb-4">
                                <h2 class="text-2xl font-bold text-gray-900">
                                    时间格式说明
                                </h2>
                                <div class="h-1 w-16 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mt-2"></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                                <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-semibold text-gray-900 mb-3">时间格式</h3>
                                        <p class="text-gray-700 mb-4">
                                            时间格式统一为 <strong>MM:SS.fff</strong>，支持多种输入方式，系统会自动转换。
                                        </p>
                                        <div class="space-y-3">
                                            <div class="time-format-item p-3 bg-gray-50 rounded-lg border border-gray-100 flex items-start gap-3">
                                                <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-sm font-medium mt-0.5">
                                                    1
                                                </div>
                                                <div>
                                                    <div class="font-mono text-gray-900">02:59.000</div>
                                                    <div class="text-sm text-gray-600">完整格式（2分59秒0毫秒）</div>
                                                </div>
                                            </div>
                                            <div class="time-format-item p-3 bg-gray-50 rounded-lg border border-gray-100 flex items-start gap-3">
                                                <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-sm font-medium mt-0.5">
                                                    2
                                                </div>
                                                <div>
                                                    <div class="font-mono text-gray-900">59.000</div>
                                                    <div class="text-sm text-gray-600">简化格式（59秒0毫秒）</div>
                                                </div>
                                            </div>
                                            <div class="time-format-item p-3 bg-gray-50 rounded-lg border border-gray-100 flex items-start gap-3">
                                                <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-sm font-medium mt-0.5">
                                                    3
                                                </div>
                                                <div>
                                                    <div class="font-mono text-gray-900">59</div>
                                                    <div class="text-sm text-gray-600">纯数字格式（59秒）</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- 注意事项 -->
                        <section id="manual-notes" class="manual-section">
                            <div class="section-header mb-4">
                                <h2 class="text-2xl font-bold text-gray-900">
                                    注意事项
                                </h2>
                                <div class="h-1 w-16 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mt-2"></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                                <div class="space-y-4">
                                    <div class="note-item p-4 bg-yellow-50 rounded-lg border border-yellow-100 flex items-start gap-3">
                                        <i class="fas fa-exclamation-triangle text-yellow-600 mt-1"></i>
                                        <div>
                                            <h3 class="font-medium text-yellow-900 mb-1">角色数量限制</h3>
                                            <p class="text-sm text-yellow-800">
                                                最多可添加6个角色，且只能有一个角色启用回费功能
                                            </p>
                                        </div>
                                    </div>
                                    <div class="note-item p-4 bg-blue-50 rounded-lg border border-blue-100 flex items-start gap-3">
                                        <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                                        <div>
                                            <h3 class="font-medium text-blue-900 mb-1">初始时间说明</h3>
                                            <p class="text-sm text-blue-800">
                                                初始时间代表开始回费的时间，而不是场景最开始的时间
                                            </p>
                                        </div>
                                    </div>
                                    <div class="note-item p-4 bg-blue-50 rounded-lg border border-blue-100 flex items-start gap-3">
                                        <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                                        <div>
                                            <h3 class="font-medium text-blue-900 mb-1">数据联动</h3>
                                            <p class="text-sm text-blue-800">
                                                修改数据项时，系统会自动重新计算所有后续数据项
                                            </p>
                                        </div>
                                    </div>
                                    <div class="note-item p-4 bg-red-50 rounded-lg border border-red-100 flex items-start gap-3">
                                        <i class="fas fa-warning text-red-600 mt-1"></i>
                                        <div>
                                            <h3 class="font-medium text-red-900 mb-1">角色删除</h3>
                                            <p class="text-sm text-red-800">
                                                删除角色时，如果该角色已被数据项引用，需要先删除相关数据项
                                            </p>
                                        </div>
                                    </div>
                                    <div class="note-item p-4 bg-green-50 rounded-lg border border-green-100 flex items-start gap-3">
                                        <i class="fas fa-save text-green-600 mt-1"></i>
                                        <div>
                                            <h3 class="font-medium text-green-900 mb-1">数据保存</h3>
                                            <p class="text-sm text-green-800">
                                                建议定期保存数据，避免意外丢失
                                            </p>
                                        </div>
                                    </div>
                                    <div class="note-item p-4 bg-purple-50 rounded-lg border border-purple-100 flex items-start gap-3">
                                        <i class="fas fa-calculator text-purple-600 mt-1"></i>
                                        <div>
                                            <h3 class="font-medium text-purple-900 mb-1">更改扣除规则</h3>
                                            <p class="text-sm text-purple-800">
                                                更改扣除规则会直接覆盖目标行的费用扣除数值，即使目标行已被赋予减费效果，减费效果的生效次数仍会消耗
                                            </p>
                                        </div>
                                    </div>
                                    <div class="note-item p-4 bg-orange-50 rounded-lg border border-orange-100 flex items-start gap-3">
                                    <i class="fas fa-lightbulb text-orange-600 mt-1"></i>
                                    <div>
                                        <h3 class="font-medium text-orange-900 mb-1">减费效果生效次数</h3>
                                        <p class="text-sm text-orange-800">
                                            减费效果的生效次数用完后，角色技能费用会自动恢复原值
                                        </p>
                                    </div>
                                </div>
                                <div class="note-item p-4 bg-yellow-50 rounded-lg border border-yellow-100 flex items-start gap-3">
                                    <i class="fas fa-bolt text-yellow-600 mt-1"></i>
                                    <div>
                                        <h3 class="font-medium text-yellow-900 mb-1">持续回费功能</h3>
                                        <p class="text-sm text-yellow-800">
                                            持续回费功能会在指定时间范围内增加回费速度，选择目标行后点击"持续回费功能"按钮进行设置
                                        </p>
                                    </div>
                                </div>
                                <div class="note-item p-4 bg-green-50 rounded-lg border border-green-100 flex items-start gap-3">
                                    <i class="fas fa-trash text-green-600 mt-1"></i>
                                    <div>
                                        <h3 class="font-medium text-green-900 mb-1">数据项删除</h3>
                                        <p class="text-sm text-green-800">
                                            删除数据项时，系统会自动删除关联的规则，确保数据一致性
                                        </p>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    
                    <!-- 页脚区域 -->
                    <div class="manual-footer mt-10 pt-6 border-t border-gray-200 text-center">
                        <p class="text-sm text-gray-500">
                            <i class="fas fa-copyright mr-1"></i>
                            碧蓝档案轴计算器 © 2025
                        </p>
                        <p class="text-xs text-gray-400 mt-1">
                            本工具仅供学习交流使用，非官方工具
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="closeModal btn-primary">我知道了</button>
            </div>
        </div>
    </div>


    <!-- 关于弹窗 -->
    <div id="aboutModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-semibold">关于</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <img src="https://q1.qlogo.cn/g?b=qq&nk=1441736707&s=100" alt="作者头像" class="w-20 h-20 rounded-full mb-2 border-2 border-primary">
                    <h4 class="text-xl font-bold">碧蓝档案轴计算器</h4>
                    <p class="text-gray-500">版本 2.0.0</p>
                </div>
                <p class="text-center mb-4">一款用于管理游戏角色属性、精准计算技能费用与回费时间的工具，帮助玩家高效规划游戏内角色技能释放节奏。</p>
                <div class="text-center mb-4">
                    <button id="authorHomepage" class="btn-secondary">
                        <i class="fas fa-user mr-1"></i>前往作者主页
                    </button>
                </div>
                <div class="text-center text-sm text-gray-500">
                    <p>© 2025 碧蓝档案轴计算器</p>
                    <p>本工具仅供学习交流使用，非官方工具</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="closeModal btn-primary">关闭</button>
            </div>
        </div>
    </div>


    <!-- 初始化时间输入弹窗 -->
    <div id="initializeModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-semibold">初始化数据表</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="initializeForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">初始时间</label>
                        <input type="text" id="initialTime" class="input-field w-full time-input" placeholder="00:00.000" required>
                        <p class="text-xs text-gray-500 mt-1">格式：MM:SS.fff（分钟:秒.毫秒）</p>
                    </div>
                    <div class="space-y-2">
                        <div class="bg-blue-50 p-3 rounded-lg text-sm flex items-start">
                            <i class="fas fa-info-circle text-blue-500 mr-2 mt-0.5"></i>
                            <p class="text-blue-700 m-0">初始时间代表开始回费的时间，而不是场景最开始的时间</p>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded-lg text-sm flex items-start">
                            <i class="fas fa-exclamation-triangle text-yellow-500 mr-2 mt-0.5"></i>
                            <p class="text-yellow-700 m-0">初始化将清空现有数据，是否继续？</p>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="closeModal btn-outline">取消</button>
                <button id="confirmInitializeBtn" class="btn-accent" type="submit" form="initializeForm">确认初始化</button>
            </div>
        </div>
    </div>


    <!-- 确认对话框 -->
    <div id="confirmModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmTitle" class="text-lg font-semibold">确认操作</h3>
            </div>
            <div class="modal-body">
                <p id="confirmMessage" class="mb-4">确定要执行此操作吗？</p>
            </div>
            <div class="modal-footer">
                <button id="cancelConfirmBtn" class="btn-outline">取消</button>
                <button id="acceptConfirmBtn" class="btn-danger">确认</button>
            </div>
        </div>
    </div>


    
    <!-- 角色特殊技能模态框 -->
    <div id="specialSkillsModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content large max-w-4xl">
            <div class="modal-header bg-gradient-to-r from-blue-600 to-purple-600 text-white">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <i class="fas fa-star"></i>
                    角色特殊技能
                </h3>
            </div>
            <div class="modal-body p-6">
                <!-- 状态栏 -->
                <div id="specialSkillsStatusBar" class="status-bar mb-4">
                    <div class="status-bar-header">
                        <h4 class="status-bar-title">
                            <i class="fas fa-info-circle"></i>
                            已应用的特殊技能
                        </h4>
                    </div>
                    <div id="statusBarContent" class="status-bar-content">
                        <p class="status-bar-empty">暂未应用任何特殊技能</p>
                    </div>
                </div>
                
                <div id="specialSkillsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- 技能卡片将通过JavaScript动态生成 -->
                </div>
                <!-- 关闭按钮 - 移除modal-footer容器，直接放在body底部右侧 -->
                <div class="flex justify-end mt-6">
                    <button class="close-button btn-outline">关闭</button>
                </div>
            </div>
        </div>
    </div>
    





    <!-- 持续回费功能模态框 -->
    <div id="skillBindingModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="modal-content max-w-md">
            <div class="modal-header bg-gradient-to-r from-blue-600 to-purple-600 text-white">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <i class="fas fa-bolt"></i>
                    持续回费功能
                </h3>
                <button class="closeModal text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body p-6">
                <form id="continuousChargeForm">
                    <!-- 已选中目标行信息 -->
                    <div class="form-group mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">已选中目标行</label>
                        <div id="selectedTargetRowInfo" class="bg-gray-50 border border-gray-200 p-3 rounded">
                            <p class="text-sm text-gray-500">请先在数据表中选择一行作为目标行</p>
                        </div>
                    </div>
                    
                    <!-- 延迟时间 -->
                    <div class="form-group mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">延迟时间 (秒)</label>
                        <input type="number" id="delayTime" class="input-field w-full" min="0" step="0.001" placeholder="0.000" required>
                        <p class="text-xs text-gray-500 mt-1">从目标行时间减去延迟时间开始生效</p>
                    </div>
                    
                    <!-- 持续时间 -->
                    <div class="form-group mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">持续时间 (秒)</label>
                        <input type="number" id="duration" class="input-field w-full" min="0" step="0.001" placeholder="0.000" required>
                        <p class="text-xs text-gray-500 mt-1">回费速度增加的持续时间</p>
                    </div>
                    
                    <!-- 增加回费速度 -->
                    <div class="form-group mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">增加回费速度 (c/s)</label>
                        <input type="number" id="recoveryIncrease" class="input-field w-full" min="0" step="0.001" placeholder="0.000" required>
                        <p class="text-xs text-gray-500 mt-1">直接增加到总回费速度中</p>
                    </div>
                    
                    <!-- 按钮组 -->
                    <div class="flex justify-end gap-2">
                        <button type="button" id="cancelBindingBtn" class="btn-outline">取消</button>
                        <button type="submit" id="saveBindingBtn" class="btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- 应用主入口文件 -->
    <script type="module" src="./src/js/index.js"></script>
    
    <!-- 全局调试函数 -->
    <script>
        window.debugApp = () => {
            console.log('应用实例:', window.App);
            if (window.App) {
                console.log('数据管理器:', window.App.dataManager);
                console.log('事件监听器:', window.App.eventListeners);
                console.log('UI渲染器:', window.App.uiRenderer);
                console.log('计算管理器:', window.App.calculator);
                console.log('角色列表:', window.App.dataManager.characters);
                console.log('规则列表:', window.App.dataManager.rules);
                console.log('数据项列表:', window.App.dataManager.dataItems);
            }
        };
    </script>
</body>
</html>
